<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Emory COVID-19 Response Collaborative</title>
    <meta charset="utf-8" />
    <meta name="author" content="EpiRhandbook Team      epiRhandbook     epirhandbook@gmail.com" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding/datatables.js"></script>
    <link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Emory COVID-19 Response Collaborative
## Data visualization with ggplot2: an overview and demonstration
### <a href="https:://epirhandbook.com">EpiRhandbook Team</a> <br><br> <svg viewBox="0 0 512 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:white;" xmlns="http://www.w3.org/2000/svg"> <path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg> <a href="https://twitter.com/epiRhandbook">epiRhandbook</a> <br> <svg viewBox="0 0 512 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:white;" xmlns="http://www.w3.org/2000/svg"> <path d="M440 6.5L24 246.4c-34.4 19.9-31.1 70.8 5.7 85.9L144 379.6V464c0 46.4 59.2 65.5 86.6 28.6l43.8-59.1 111.9 46.2c5.9 2.4 12.1 3.6 18.3 3.6 8.2 0 16.3-2.1 23.6-6.2 12.8-7.2 21.6-20 23.9-34.5l59.4-387.2c6.1-40.1-36.9-68.8-71.5-48.9zM192 464v-64.6l36.6 15.1L192 464zm212.6-28.7l-153.8-63.5L391 169.5c10.7-15.5-9.5-33.5-23.7-21.2L155.8 332.6 48 288 464 48l-59.4 387.3z"></path></svg> <a href="mailto:epirhandbook@gmail.com">epirhandbook@gmail.com</a>
### August 2021

---





&lt;style type="text/css"&gt;
/* THIS IS A CSS CHUNK - THIS IS A COMMENT */

/* Size of font in code echo. E.g. 10px or 50% */
.remark-code {
  font-size: 70%;
}


/* Size of font in text */

.medium-text {
  font-size: 75%;     
}

/* Size of font in tables */

.small-table table {
  font-size: 6px;     
}

.medium-table table {
  font-size: 8px;     
}

.medium-large-table table {
  font-size: 10px;     
}

&lt;/style&gt;











# About us  

## R support for applied epis  

![](https://github.com/appliedepi/epiRhandbook_eng/raw/master/images/Epi%20R%20Handbook%20Banner%20Beige%201500x500.png)

* We are a grassroots collaborative of applied epidemiologists  
* The (free) Epi R Handbook has been used by 40,000 people worldwide
* Now we offer customized training to health departments and NGOs  


*Bookmark www.epiRhandbook.com*  


???
- What makes us different is that we focus on the challenges of applied epi, not academic epi. We emphasize the skills used every day by ground-level epidemiologists. 





---
# Today's session   

Today is primarily *explanation* and *demonstration*, following from the previous [demonstration on data management and workflow](https://appliedepi.github.io/emory_training/presentation/slides.html).  

We assume you have reviewed the Handbook pages on [R Basics](https://epirhandbook.com/r-basics.html) and [ggplot basics](https://epirhandbook.com/ggplot-basics.html).  

![](https://github.com/appliedepi/emory_training/blob/master/presentation/images/EDGE.png?raw=true)  




???
- The learning process can be summarised into this acronym "EDGE". Today's session is primarily a *demonstration* with question &amp; answer session. We assume that you have read at least some of the relevant pages in the Epi R Handbook prior to this session. We also offer trainings in which we guide you through case studies with hands-on coaching. 


---
# Outline

1) Setting the scene (directory, packages, data import)  
2) Fundamentals of ggplot  
3) Bar charts  
4) Epidemic curves  
5) Demographic pyramids  
6) Scatter plots  
7) Plot captions  

The Epi R Handbook contains more examples and more complex plots, for your personal reading  







---
# Visualization options in R  

Today we focus on **ggplot2** because:  

* It is good for fast data exploration of multi-dimensional data  
* It produces very high quality final outputs  
* Is accompanied by many packages that expand functionality  
* Has well-structured grammar = consistency  

Other plotting options include **base** R, **lattice**, and **plotly**  










---
# Setting the scene - directory structure  

Our R work is conducted within a dedicated directory that contains:  

* An R project (optional but advised)  
* Rmarkdown script(s)  
* A data folder  


```
## C:/Users/neale/OneDrive - Neale Batra/Documents/Analytics-LAPTOP-RS5P2IBO/R/Projects/R handbook/Trainings/Emory Aug 2021/emory_training/case_study
## +-- case_study.Rproj
## +-- data
## |   +-- covid_example_data
## |   |   +-- covid_example_data.xlsx
## |   |   \-- covid_shapefile
## |   |       +-- FultonCountyZipCodes.cpg
## |   |       +-- FultonCountyZipCodes.dbf
## |   |       +-- FultonCountyZipCodes.prj
## |   |       +-- FultonCountyZipCodes.sbn
## |   |       +-- FultonCountyZipCodes.sbx
## |   |       +-- FultonCountyZipCodes.shp
## |   |       +-- FultonCountyZipCodes.shp.xml
## |   |       \-- FultonCountyZipCodes.shx
## |   +-- linelist_cleaned.rds
## |   +-- linelist_cleaned.xlsx
## |   \-- linelist_raw.xlsx
## \-- weekly_report.Rmd
```








---
# Load packages  

**ggplot2** is included within the **tidyverse** mega-package (read more [here](https://www.tidyverse.org/)).  


```r
pacman::p_load(
  rio,            # import/export
  here,           # file locator
  rmarkdown,      # reports
  lubridate,      # working with dates
  tidyverse       # mega-package for data management and visualization
  )
```

The **tidyverse** also includes these packages:  
* **dplyr** (data management)  
* **stringr** (characters and text)  
* **forcats** (factors / ordered categories)  
* and many others...  








---

class: remark-code

# Import data

We use a *clean* dataset, to focus on visualization techniques.  

* Use `import()` from **rio** to import an RDS file  
* Use `here()` from **here** to locate the file relative to the R project root




```r
linelist_raw &lt;- import(here("case_study", "data", "covid_example_data", "covid_example_data.xlsx"))
```

*Note: The `import()` function can import almost any kind of file. A .rds file stores an R data frame and retains column classes*  



---

class: remark-code

# Clean data  

Below is the code we use to clean the data. We will not linger here today, but it is available for you to review later.  


```r
linelist &lt;- linelist_raw %&gt;% 
  filter(confirmed_case == "Yes") %&gt;% 
  
  select(                                       # use select() to retain columns
    date_report  = reprt_creationdt_FALSE,      # (it can also be used to re-name)
    date_dob     = case_dob_FALSE,              # NEW name = OLD name
    age          = case_age,                    # aligned for readability
    gender       = case_gender,
    zip          = case_zip,
    eth          = case_eth,
    id           = Contact_id, 
    date_onset   = sym_startdt_FALSE,
    sym_fever,
    sym_cough,
    sym_headache,
    sym_losstastesmell,
    sym_sorethroat,
    sym_myalgia,
    contact_hh        = contact_household,
    hospitalized,
    date_hospitalized = hosp_admidt_FALSE,
    date_discharge    = hosp_dischdt_FALSE,
    died,
    died_covid,
    date_died         = died_dt_FALSE,
    lat               = latitude_JITT,
    lon               = longitude_JITT) %&gt;% 
  
  # convert column classes
  mutate(age = as.numeric(age)) %&gt;%             # convert class
  mutate(zip = as_factor(zip)) %&gt;% 
  mutate(across(contains("date"), ymd)) %&gt;%     # convert all date columns, ymd() from lubridate

  # clean died column
  mutate(
    died = fct_explicit_na(died, na_level = "Unknown"),
    died = fct_relevel(died, "Yes", "No", "Unknown")
    ) %&gt;% 
  
  # remove onset dates prior to 2020
  mutate(across(
    .cols = c(date_report, date_onset, date_hospitalized, date_discharge, date_died),
    .fns  = ~ replace(.x, .x &lt; as.Date("2020-01-01"), NA)
    ))%&gt;% 
  
  # Remove dates after today from all date columns
  mutate(across(
    .cols = contains("date"),
    .fns  =  ~ replace(.x, .x &gt; Sys.Date(), NA)
    )) %&gt;% 
  
  # delay onset to hospitalization
  mutate(
    days_onset_hosp = as.numeric(date_hospitalized - date_onset),
    days_onset_hosp = replace(days_onset_hosp, days_onset_hosp &lt; 0, NA),
    days_onset_hosp = replace(days_onset_hosp, days_onset_hosp &gt; 30, NA)
    ) %&gt;% 

  # length hospitalization
  mutate(
    date_outcome = coalesce(date_died, date_discharge),
    days_hosp = as.numeric(date_outcome - date_hospitalized),
    days_hosp = replace(days_hosp, days_hosp &lt; 0, NA),
    days_hosp = replace(days_hosp, days_hosp &gt; 60, NA)
    )
```





---

class: small-table

# Review data  



```r
# You can use `skim()` from the skimr package.  
skim(linelist) %&gt;% 
  filter(skim_type == "character")
```


Table: Data summary

|                         |         |
|:------------------------|:--------|
|Name                     |linelist |
|Number of rows           |82062    |
|Number of columns        |26       |
|_______________________  |         |
|Column type frequency:   |         |
|character                |12       |
|________________________ |         |
|Group variables          |None     |


**Variable type: character**

|skim_variable      | n_missing| complete_rate| min| max| empty| n_unique| whitespace|
|:------------------|---------:|-------------:|---:|---:|-----:|--------:|----------:|
|gender             |        60|          1.00|   4|   7|     0|        3|          0|
|eth                |      2571|          0.97|  13|  19|     0|        3|          0|
|id                 |     32194|          0.61|   7|  15|     0|        3|          0|
|sym_fever          |     31567|          0.62|   2|   3|     0|        3|          0|
|sym_cough          |     31620|          0.61|   2|   3|     0|        3|          0|
|sym_headache       |     32008|          0.61|   2|   3|     0|        3|          0|
|sym_losstastesmell |     50711|          0.38|   2|   3|     0|        3|          0|
|sym_sorethroat     |     32231|          0.61|   2|   3|     0|        3|          0|
|sym_myalgia        |     32127|          0.61|   2|   3|     0|        4|          0|
|contact_hh         |     36725|          0.55|   2|   3|     0|        3|          0|
|hospitalized       |     32473|          0.60|   2|   3|     0|        2|          0|
|died_covid         |     42285|          0.48|   2|  12|     0|        3|          0|

---

class: small-table

# Review data  


```r
skimr::skim(linelist) %&gt;% 
  filter(skim_type == "Date")
```


Table: Data summary

|                         |         |
|:------------------------|:--------|
|Name                     |linelist |
|Number of rows           |82062    |
|Number of columns        |26       |
|_______________________  |         |
|Column type frequency:   |         |
|Date                     |7        |
|________________________ |         |
|Group variables          |None     |


**Variable type: Date**

|skim_variable     | n_missing| complete_rate|min        |max        |median     | n_unique|
|:-----------------|---------:|-------------:|:----------|:----------|:----------|--------:|
|date_report       |        11|          1.00|2020-01-03 |2021-07-22 |2020-12-04 |      527|
|date_dob          |        68|          1.00|1914-12-28 |2021-07-17 |1984-05-09 |    26746|
|date_onset        |     37519|          0.54|2020-01-01 |2021-07-18 |2020-11-22 |      552|
|date_hospitalized |     77105|          0.06|2020-01-05 |2021-07-12 |2020-10-13 |      495|
|date_discharge    |     78583|          0.04|2020-01-13 |2021-07-07 |2020-10-21 |      488|
|date_died         |     80357|          0.02|2020-02-21 |2021-07-01 |2020-12-11 |      429|
|date_outcome      |     77495|          0.06|2020-01-13 |2021-07-07 |2020-11-14 |      493|


---

class: small-table

# Review data  


```r
skimr::skim(linelist) %&gt;% 
  filter(skim_type == "numeric")
```


Table: Data summary

|                         |         |
|:------------------------|:--------|
|Name                     |linelist |
|Number of rows           |82062    |
|Number of columns        |26       |
|_______________________  |         |
|Column type frequency:   |         |
|numeric                  |5        |
|________________________ |         |
|Group variables          |None     |


**Variable type: numeric**

|skim_variable   | n_missing| complete_rate|   mean|    sd|    p0|    p25|    p50|    p75|   p100|hist                                     |
|:---------------|---------:|-------------:|------:|-----:|-----:|------:|------:|------:|------:|:----------------------------------------|
|age             |        47|          1.00|  39.69| 19.16| -20.0|  25.00|  37.00|  53.00| 106.00|▁▇▇▃▁ |
|lat             |        58|          1.00|  32.58|  6.38|   0.0|  33.69|  33.78|  33.98|  34.19|▁▁▁▁▇ |
|lon             |       164|          1.00| -81.39| 15.65| -84.8| -84.46| -84.38| -84.35|   0.00|▇▁▁▁▁ |
|days_onset_hosp |     78526|          0.04|   4.56|  5.44|   0.0|   0.00|   3.00|   7.00|  30.00|▇▂▁▁▁ |
|days_hosp       |     78466|          0.04|   7.80|  9.63|   0.0|   2.00|   5.00|   9.00|  60.00|▇▁▁▁▁ |





---

class: small-table

# Review data  

Below are the first rows of the `linelist` data frame:  

<div id="htmlwidget-08b1a993dc1271ef0fe4" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-08b1a993dc1271ef0fe4">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25"],["2020-03-22","2020-02-01","2020-02-10","2020-03-20","2020-02-26","2020-02-11","2020-03-01","2020-03-01","2020-03-18","2020-03-12","2020-02-26","2020-04-10","2020-04-06","2020-03-20","2020-03-05","2020-03-05","2020-02-24","2020-04-04","2020-03-28","2020-04-07","2020-04-06","2020-02-26","2020-04-12","2020-04-01","2020-02-28"],["2004-11-08","1964-06-07","1944-04-06","1964-06-25","1964-12-21","1956-06-21","1974-05-25","1960-02-17","1985-06-09","1978-11-26","1946-12-21","1993-10-27","1941-06-04","1954-03-19","1958-10-22","1929-10-22","1952-01-11","1994-01-01","1995-12-25","1987-09-14","1981-12-12","1975-07-11","1948-01-11","1974-05-30","1977-01-04"],[16,57,77,57,56,65,47,61,36,42,74,27,80,67,62,91,69,27,25,33,39,46,73,47,44],["Male","Male","Female","Female","Male","Male","Male","Female","Male","Female","Male","Female","Female","Male","Female","Male","Male","Male","Male","Female","Female","Female","Male","Male","Female"],["30308","30308","30315","30213","30004","30314","30313","30350","30324","30305","30315","30308","30312","30213","30311","30311","30327","30349","30009","30337","30344","30315","30349","30327","30318"],["NON-HISPANIC/LATINO","NON-HISPANIC/LATINO","NON-HISPANIC/LATINO","NON-HISPANIC/LATINO","NOT SPECIFIED","NON-HISPANIC/LATINO","NON-HISPANIC/LATINO","NON-HISPANIC/LATINO","NON-HISPANIC/LATINO","NON-HISPANIC/LATINO","NON-HISPANIC/LATINO","NON-HISPANIC/LATINO","NON-HISPANIC/LATINO","NON-HISPANIC/LATINO","NON-HISPANIC/LATINO","NON-HISPANIC/LATINO","NON-HISPANIC/LATINO","NON-HISPANIC/LATINO","NON-HISPANIC/LATINO","NON-HISPANIC/LATINO","NON-HISPANIC/LATINO","NON-HISPANIC/LATINO","NON-HISPANIC/LATINO","NON-HISPANIC/LATINO","NON-HISPANIC/LATINO"],["Yes-Symptomatic","Yes-Symptomatic","Yes-Symptomatic","Yes-Symptomatic","Yes-Symptomatic","Yes-Symptomatic","Yes-Symptomatic","Yes-Symptomatic","Yes-Symptomatic","Yes-Symptomatic","Yes-Symptomatic","Yes-Symptomatic","Yes-Symptomatic","Yes-Symptomatic","Yes-Symptomatic","Yes-Symptomatic","Yes-Symptomatic","Yes-Symptomatic","Yes-Symptomatic","Yes-Symptomatic","Yes-Symptomatic","Yes-Symptomatic","Yes-Symptomatic","Yes-Symptomatic","Yes-Symptomatic"],["2020-03-20","2020-01-28","2020-02-10","2021-05-19","2020-02-20","2020-01-17","2020-02-21","2020-02-25","2020-03-17","2020-11-21","2020-02-15","2020-04-02","2020-03-22","2020-03-10","2020-03-02","2020-02-29","2020-02-19",null,"2020-03-25","2020-03-30","2020-03-29","2020-02-17","2020-03-30","2020-03-28","2020-02-26"],["Yes","No","Yes","No","Yes","Yes","No","Yes","No","Yes",null,"Unk","No","Yes","Yes","Yes","Yes","Yes","No","No","No","Yes","Yes","No","No"],["Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Yes","Unk","Yes","Yes","Yes","No","Yes","Yes","Yes","Yes",null,"Yes"],["Yes","No",null,"Yes","No","Unk","Yes","No","Yes","No",null,"No","No","Yes","Unk","No",null,"No","No","No","No","No","No",null,null],[null,null,null,null,null,null,null,null,null,"Yes",null,null,null,null,null,null,null,null,"No",null,null,null,null,null,null],["Yes","No","Yes","Yes","No","Unk","Yes","Yes","Yes","Yes",null,"No","No","No","Unk","No",null,"No","Yes","No","No","Yes","No",null,null],["No","Yes","Yes","Yes","Yes","No","Unk","No","No","Yes",null,"No","No","Yes","Unk","No",null,"Yes","No","Yes","No","No","Yes","Yes",null],["Yes","No",null,"No","No","No","No","No","No","Yes","No","No","Yes","No","Unk","No",null,"No","No","No","No","No","No","No","No"],["No","No","Yes",null,"Yes","Yes","Yes","No","No","Yes",null,"No","Yes","Yes","Yes","Yes","No","Yes","No","Yes","No","Yes","Yes","No","Yes"],[null,null,"2020-02-08",null,"2020-02-26","2020-01-27","2020-03-01",null,null,"2020-11-28",null,null,"2020-04-06","2020-03-19","2020-03-03","2020-03-03",null,"2020-04-03",null,"2020-04-06",null,"2020-02-22","2020-04-15",null,"2020-02-27"],[null,null,null,null,null,"2020-02-21",null,null,null,"2020-12-02",null,null,"2020-04-16",null,null,null,null,null,null,"2020-04-10",null,"2020-03-10","2020-04-18",null,"2020-02-27"],["No","No","No","No","Unknown","Yes","No","Unknown","No","No","Unknown","No","Yes","No","No","No","Unknown","No","No","No","No","No","No","No","No"],["No","No","No","No",null,"Yes","No",null,"No","No",null,"No","Yes","No","No","No",null,"No","No","No","No","No","No","No","No"],[null,null,null,null,null,"2020-02-21",null,null,null,null,null,null,"2020-04-16",null,null,null,null,null,null,null,null,null,null,null,null],[33.77664546,33.78051014,33.73023331,33.55506787,34.10608705,33.75937142,33.76269487,33.99152006,33.81818887,0.000509015,33.7247196,33.76662936,33.73726168,33.58325606,33.73072166,33.74443579,33.84942894,33.61755356,34.09972633,33.65329287,33.69052246,33.71013231,33.64674578,33.84126361,33.80477485],[-84.38568523,-84.38947474,-84.38425189,-84.62885167,-84.27453508,-84.42582354,-84.40045162,-84.35447278,-84.37365369,-0.000975479,-84.38623582,-84.38936047,-84.38274508,-84.63672804,-84.44208134,-84.47630174,-84.41986975,-84.46304234,-84.31308119,-84.45800906,-84.46524239,-84.38555839,-84.57468022,-84.42349808,-84.45733019],[null,null,null,null,6,10,9,null,null,7,null,null,15,9,1,3,null,null,null,7,null,5,16,null,1],[null,null,null,null,null,"2020-02-21",null,null,null,"2020-12-02",null,null,"2020-04-16",null,null,null,null,null,null,"2020-04-10",null,"2020-03-10","2020-04-18",null,"2020-02-27"],[null,null,null,null,null,25,null,null,null,4,null,null,10,null,null,null,null,null,null,4,null,17,3,null,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>date_report<\/th>\n      <th>date_dob<\/th>\n      <th>age<\/th>\n      <th>gender<\/th>\n      <th>zip<\/th>\n      <th>eth<\/th>\n      <th>id<\/th>\n      <th>date_onset<\/th>\n      <th>sym_fever<\/th>\n      <th>sym_cough<\/th>\n      <th>sym_headache<\/th>\n      <th>sym_losstastesmell<\/th>\n      <th>sym_sorethroat<\/th>\n      <th>sym_myalgia<\/th>\n      <th>contact_hh<\/th>\n      <th>hospitalized<\/th>\n      <th>date_hospitalized<\/th>\n      <th>date_discharge<\/th>\n      <th>died<\/th>\n      <th>died_covid<\/th>\n      <th>date_died<\/th>\n      <th>lat<\/th>\n      <th>lon<\/th>\n      <th>days_onset_hosp<\/th>\n      <th>date_outcome<\/th>\n      <th>days_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollY":300,"scrollX":600,"pageLength":25,"fontSize":"25%","dom":"ti","ordering":false,"rownames":false,"options":{"pageLength":5,"scrollX":true},"class":"white-space: nowrap","columnDefs":[{"className":"dt-right","targets":[3,22,23,24,26]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>





---
# Fundamentals of ggplot2





---
# gg-what??  

- The **ggplot2** *package* is the most popular data visualization tool in R  
- Its `ggplot()` *function* is at the core of the package  
- This whole approach is colloquially known as “ggploting”  
- Resulting figures are sometimes affectionately called “ggplots”  

**ggplot2** benefits from a wide variety of supplementary R packages that extends its functionalities, such as **gganimate**, **ggthemr**, **ggdendro**, **gghighlight**, **ggforce**...  

.footnote[
Question: What does the "gg” in these names represent?
]

???
- "gg" represents the “grammar of graphics” used to construct the figures 





---
# Syntax overview  

* “Add” plot layers and design elements on top of one another  
* Build a multi-layer plot object that can be saved, modified, printed, exported...  

--  

Order of layers will usually look like this:

1) The baseline `ggplot()` command “opens” the plot- typically the dataset is specified here  
2) Add “geom” layers that visualize data geometrically as shapes  
3) Add design elements such as axis labels, title, fonts, sizes, color schemes, legends, or axes rotation  


A simple example follows. We will explain each component.



---
# Syntax - open the plot  

.pull-left[

`ggplot()` creates an empty canvas.  
Assign the data frame `linelist`.  


```r
ggplot(data = linelist)                   
```

Or alternatively use the `%&gt;%` pipe operator to "pipe" the data frame *into* `ggplot()`  


```r
linelist %&gt;%
  ggplot()
```

]

.pull-right[

&lt;img src="slides_ggplot_files/figure-html/unnamed-chunk-15-1.png" width="504" /&gt;
] 

???
As you can see, this is only a blank canvas, we have not defined what should be in the x and y axes, nor linked any data to be plot. It's an empty page waiting for you. This does not produce visible changes, but ggplot will now look for columns within the *linelist* dataframe.
Notes: if several data frames are needed, they can be added in their own *geoms* (example later).





---
# Syntax - Map columns to axes  

.pull-left[

Map the `x` and `y` axes to columns in the data


```r
ggplot(data = linelist,
*       mapping = aes(
*         x = age,
*         y = days_hosp)
)
```

]

.pull-right[

&lt;img src="slides_ggplot_files/figure-html/unnamed-chunk-17-1.png" width="504" /&gt;
] 




---
# Geoms  


.pull-left[

Data are visualized using "geom" commands, such as `geom_point()`.  

Many classical “geoms”, including:  

Geometry        |Geom                
----------------|--------------------
Histograms      |`geom_histogram()`
Points          |`geom_point()`  
Lines           |`geom_line()`  
Box plots       |`geom_boxplot()`  
Bar charts      |`geom_bar()` or `geom_col()`  
Trend lines     |`geom_smooth()`  

Full list [here](https://ggplot2.tidyverse.org/reference/)  

]


.pull-right[

&lt;img src="slides_ggplot_files/figure-html/unnamed-chunk-18-1.png" width="504" /&gt;

]







---
# Syntax - "geoms"  

.pull-left[

Add a `geom_point()` command to display the data as points


```r
ggplot(data = linelist,
       mapping = aes(
         x = age,
         y = onset_hosp))
```

]

.pull-right[

&lt;img src="slides_ggplot_files/figure-html/unnamed-chunk-20-1.png" width="504" /&gt;
] 










---
# Syntax - "geoms"  

.pull-left[

Add (`+`) a `geom_point()` command to display the data as points


```r
ggplot(data = linelist,
       mapping = aes(
         x = age,
         y = onset_hosp))+
*  geom_point()
```

]

.pull-right[


&lt;img src="slides_ggplot_files/figure-html/unnamed-chunk-22-1.png" width="504" /&gt;
] 








---
# Syntax - mapping placement  

* If mappings are written in `ggplot()` they apply to all geoms (e.g. axes).  
* If mappings are written within a geom, they apply only to it.  


```r
ggplot(                     # open the plot 
  data = linelist,            # set dataset 
* mapping = aes(              # map axes to columns
*   x = age,
*   y = days_hosp))+
  geom_point()              # plot points
```

is the same as:  


```r
ggplot(data = linelist)+    # open plot and set dataset
  geom_point(               # plot points
*    mapping = aes(           # map axes to columns
*      x = age,
*      y = days_hosp))
```

(but only because there is only one geom)  


???
- Explain why you might use one or the other  






---
# Syntax - Indentations  

Indentations, spaces, and newlines do not matter for code execution, and can improve readability.  


```r
ggplot(data = linelist, mapping = aes(x = age, y = days_hosp))+
  geom_point()
```

is the same as:  


```r
ggplot(data = linelist,
       mapping = aes(
         x = age,
         y = days_hosp))+
  geom_point()
```

is the same as:  


```r
ggplot(
  data = linelist,
  mapping = aes(
    x = age,
    y = days_hosp))+
  geom_point()
```



???
- Explain why you might use one or the other  







---
# Syntax overview  

.pull-left[

Add additional geoms with `+`


```r
ggplot(data = linelist,
       mapping = aes(
         x = age,
         y = days_hosp))+
  geom_point()+
* geom_smooth()
```

]

.pull-right[

&lt;img src="slides_ggplot_files/figure-html/unnamed-chunk-29-1.png" width="504" /&gt;
] 

???
- Explain why you might use one or the other  






---

class: medium-large-table

# Syntax - other aesthetics  



.pull-left[
Aside from axes, other common "aesthetics" to specify include: 

Geometry        |Geom                
----------------|--------------------
`shape = `      |Display point as dot, star, triangle, square...
`fill =  `      |The *interior* color (e.g of bar or boxplot)  
`color = `      |The *exterior* or bar, boxplot - OR point color  
`size = `       |Line thickness, point size...
`alpha = `      |Transparency (1 = opaque, 0 = invisible)
`width = `      |Width of "bar plot" bars
`linetype = `   |Either solid, dashed, dotted, etc.  
`binwidth = `   |Width of histogram bins  
  

]


.pull-right[

&lt;img src="slides_ggplot_files/figure-html/unnamed-chunk-30-1.png" width="504" /&gt;

]



??? 
- In ggplot terminology a plot “aesthetic” has a specific meaning. It refers to a visual property of plotted data. Note that “aesthetic” here refers to the data being plotted in geoms/shapes - not the surrounding display such as titles, axis labels, background color, that you might associate with the word “aesthetics” in common English. In ggplot those details are called “themes” and are adjusted within a theme() command









---

class: medium-text

# Syntax - other aesthetics  



.pull-left[

These aesthetics can be assigned to either:  

* Static values (e.g. `alpha = 0.3`)  
  - Assign *outside* a `mapping = aes()`  
* A data column (e.g. `aes(fill = ethnicity)`)  
  - Assign *inside* a `mapping = aes()`  

If together, a command might look like:  



This later option creates "groups" in the display of the data.  

]


.pull-right[

&lt;img src="slides_ggplot_files/figure-html/unnamed-chunk-32-1.png" width="504" /&gt;

]







---
# Syntax - other aesthetics  

.pull-left[

Define an aesthetic value as *static* (applying to all data points) by writing it within the geom but outside the `aes()`  


```r
ggplot(data = linelist,
       mapping = aes(
         x = age,
         y = days_hosp),
*      color = "seagreen")+ # outside aes()
  geom_point()
```

]

.pull-right[

&lt;img src="slides_ggplot_files/figure-html/unnamed-chunk-34-1.png" width="504" /&gt;
] 






---
# Syntax - other aesthetics   

.pull-left[

Define an aesthetic value as *dynamic* (varying for each data point) by writing it within the geom *and within the `aes()`  


```r
ggplot(data = linelist,
       mapping = aes(
         x = age,
         y = days_hosp,
*        color = died))+   # inside aes() for dynamic
  geom_point()
```

]

.pull-right[

&lt;img src="slides_ggplot_files/figure-html/unnamed-chunk-36-1.png" width="504" /&gt;
]





---
# Syntax - other aesthetics  

.pull-left[

Another example: 

* `color` is set to vary by the value in column `died`  
* `alpha` (transparency) is set at 30% for all points  


```r
ggplot(data = linelist,
       mapping = aes(
         x = age,
         y = days_hosp,
         color = died),    # inside aes() for dynamic
*      alpha = 0.3)+       # outside aes() for static
  geom_point() 
```

Written a different (equivalent) way:  


```r
ggplot(data = linelist)+
  geom_point(mapping = aes(x = age, y = days_hosp, color = died), alpha = 0.3)
```


]

.pull-right[

&lt;img src="slides_ggplot_files/figure-html/unnamed-chunk-39-1.png" width="504" /&gt;
]



---
# Syntax - labels  

.pull-left[

Add labels for title, axes, and legend  


```r
ggplot(data = linelist,
       mapping = aes(
         x = age,
         y = days_hosp,
         color = died),    
       alpha = 0.3)+
  geom_point()+
* labs(
*    title = "Duration of admission among hospitalized COVID-19 patients",
*    x = "Age (years)",
*    y = "Duration (days)",
*    caption = "Fictional COVID-19 data",
*    color = "Deceased"
)
```

]

.pull-right[

&lt;img src="slides_ggplot_files/figure-html/unnamed-chunk-41-1.png" width="504" /&gt;
]




---
# Syntax - theme  

.pull-left[

`theme()` adjusts non-data plot features. Pre-defined themes are easy to add.  


```r
ggplot(data = linelist,
       mapping = aes(
         x = age,
         y = days_hosp,
         color = died),    
       alpha = 0.3)+
  geom_point()+
  labs(
     title = "Duration of admission among hospitalized COVID-19 patients",
     x = "Age (years)",
     y = "Duration (days)",
     caption = "Fictional COVID-19 data",
     color = "Deceased")+
* theme_minimal(base_size = 14)
```

]

.pull-right[

&lt;img src="slides_ggplot_files/figure-html/unnamed-chunk-43-1.png" width="504" /&gt;
]



---
# Syntax - theme  

.pull-left[

Micro-adjust with `theme()` (micro commands for each small feature)  

See the [complete list](https://ggplot2.tidyverse.org/reference/theme.html)  


```r
ggplot(data = linelist,
       mapping = aes(
         x = age,
         y = days_hosp,
         color = died),    
       alpha = 0.3)+
  geom_point()+
  labs(
     title = "Duration of admission among hospitalized COVID-19 patients",
     x = "Age (years)",
     y = "Duration (days)",
     caption = "Fictional COVID-19 data",
     color = "Deceased")+
  theme_minimal()+
* theme(legend.position = "bottom")
```

]

.pull-right[

&lt;img src="slides_ggplot_files/figure-html/unnamed-chunk-45-1.png" width="504" /&gt;
]





---  

# Labeling  

Aggregate zip codes into number of cases and number of deaths


---  

# Final slide

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
